var OPTION_LEAVE_FORMULA_AS_A_COMMENT=true;JDecConverter=(function(){function c(g,d){function f(){this.constructor=g}f.prototype=d.prototype;g.prototype=new f()}function b(g,f,h,d){this.message=g;this.expected=f;this.found=h;this.location=d;this.name="SyntaxError";if(typeof Error.captureStackTrace==="function"){Error.captureStackTrace(this,b)}}c(b,Error);b.buildMessage=function(k,m){var j={literal:function(n){return'"'+i(n.text)+'"'},"class":function(n){var p="",o;for(o=0;o<n.parts.length;o++){p+=n.parts[o] instanceof Array?d(n.parts[o][0])+"-"+d(n.parts[o][1]):d(n.parts[o])}return"["+(n.inverted?"^":"")+p+"]"},any:function(n){return"any character"},end:function(n){return"end of input"},other:function(n){return n.description}};function g(n){return n.charCodeAt(0).toString(16).toUpperCase()}function i(n){return n.replace(/\\/g,"\\\\").replace(/"/g,'\\"').replace(/\0/g,"\\0").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/[\x00-\x0F]/g,function(o){return"\\x0"+g(o)}).replace(/[\x10-\x1F\x7F-\x9F]/g,function(o){return"\\x"+g(o)})}function d(n){return n.replace(/\\/g,"\\\\").replace(/\]/g,"\\]").replace(/\^/g,"\\^").replace(/-/g,"\\-").replace(/\0/g,"\\0").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/[\x00-\x0F]/g,function(o){return"\\x0"+g(o)}).replace(/[\x10-\x1F\x7F-\x9F]/g,function(o){return"\\x"+g(o)})}function h(n){return j[n.type](n)}function f(q){var o=new Array(q.length),p,n;for(p=0;p<q.length;p++){o[p]=h(q[p])}o.sort();if(o.length>0){for(p=1,n=1;p<o.length;p++){if(o[p-1]!==o[p]){o[n]=o[p];n++}}o.length=n}switch(o.length){case 1:return o[0];case 2:return o[0]+" or "+o[1];default:return o.slice(0,-1).join(", ")+", or "+o[o.length-1]}}function l(n){return n?'"'+i(n)+'"':"end of input"}return"Expected "+f(k)+" but "+l(m)+" found."};function a(aC,D){D=D!==void 0?D:{};var ar={},n={Expression:aj},af=aj,aa="+",Y=ah("+",false),W="-",U=ah("-",false),S=function(aJ,aL,aK){var aM=j(aK,function(aO,aN){var aQ=aN[1];var aR=aN[3];var aP=aN[5];return p(aO,G(aQ),aP,aR,")")},aL);if(aM.length>0){aM.splice(1,0,aJ)}return aM.join("")},Q="*",O=ah("*",false),M="/",K=ah("/",false),I="%",f=ah("%",false),aI=function(aK,aJ){return j(aJ,function(aM,aL){var aO=aL[1];var aP=aL[3];var aN=aL[5];return p(aM,G(aO),aN,aP,")")},aK)},aH="^",aF=ah("^",false),aE=function(aK,aJ){return j(aJ,function(aM,aL){var aO=aL[1];var aP=aL[3];var aN=aL[5];return p(aM,G(aO),aN,aP,".intValue()",")")},[aK])},aD="(",aA=ah("(",false),az=",",ay=ah(",",false),ax=")",au=ah(")",false),at=function(aL,aM,aJ){var aN=(aL?aL:"")+"("+aM;if(aJ){for(var aK=0;aK<aJ.length;++aK){aN+=", "+aJ[aK][3]}}return aN+")"},aq=h("sign"),ap=function(aJ){return l(aJ)},ao=h("decimal"),an=/^[0-9]/,am=r([["0","9"]],false,false),al=".",ak=ah(".",false),ai=function(){return ae+'"'+ag()+'")'},Z=h("code"),X=/^[a-zA-Z$_]/,V=r([["a","z"],["A","Z"],"$","_"],false,false),T=/^[a-zA-Z$_0-9]/,R=r([["a","z"],["A","Z"],"$","_",["0","9"]],false,false),P=function(){return ag()},N=h("whitespace2"),L=/^[ \t\n\r]/,J=r([" ","\t","\n","\r"],false,false),H=h("whitespace"),F=0,q=0,E=[{line:1,column:1}],A=0,aB=[],C=0,o;if("startRule" in D){if(!(D.startRule in n)){throw new Error("Can't start parsing from rule \""+D.startRule+'".')}af=n[D.startRule]}function ag(){return aC.substring(q,F)}function aw(){return aG(q,F)}function m(aK,aJ){aJ=aJ!==void 0?aJ:aG(q,F);throw y([h(aK)],aC.substring(q,F),aJ)}function ac(aK,aJ){aJ=aJ!==void 0?aJ:aG(q,F);throw s(aK,aJ)}function ah(aK,aJ){return{type:"literal",text:aK,ignoreCase:aJ}}function r(aL,aK,aJ){return{type:"class",parts:aL,inverted:aK,ignoreCase:aJ}}function u(){return{type:"any"}}function ab(){return{type:"end"}}function h(aJ){return{type:"other",description:aJ}}function ad(aL){var aJ=E[aL],aK;if(aJ){return aJ}else{aK=aL-1;while(!E[aK]){aK--}aJ=E[aK];aJ={line:aJ.line,column:aJ.column};while(aK<aL){if(aC.charCodeAt(aK)===10){aJ.line++;aJ.column=1}else{aJ.column++}aK++}E[aL]=aJ;return aJ}}function aG(aK,aJ){var aM=ad(aK),aL=ad(aJ);return{start:{offset:aK,line:aM.line,column:aM.column},end:{offset:aJ,line:aL.line,column:aL.column}}}function x(aJ){if(F<A){return}if(F>A){A=F;aB=[]}aB.push(aJ)}function s(aK,aJ){return new b(aK,null,null,aJ)}function y(aK,aL,aJ){return new b(b.buildMessage(aK,aL),aK,aL,aJ)}function aj(){var aU,aT,aR,aP,aO,aN,aM,aL,aK,aJ,aS,aQ;aU=F;aT=i();if(aT!==ar){aR=av();if(aR!==ar){aP=t();if(aP!==ar){aO=[];aN=F;aM=av();if(aM!==ar){if(aC.charCodeAt(F)===43){aL=aa;F++}else{aL=ar;if(C===0){x(Y)}}if(aL===ar){if(aC.charCodeAt(F)===45){aL=W;F++}else{aL=ar;if(C===0){x(U)}}}if(aL!==ar){aK=av();if(aK!==ar){aJ=i();if(aJ!==ar){aS=av();if(aS!==ar){aQ=t();if(aQ!==ar){aM=[aM,aL,aK,aJ,aS,aQ];aN=aM}else{F=aN;aN=ar}}else{F=aN;aN=ar}}else{F=aN;aN=ar}}else{F=aN;aN=ar}}else{F=aN;aN=ar}}else{F=aN;aN=ar}while(aN!==ar){aO.push(aN);aN=F;aM=av();if(aM!==ar){if(aC.charCodeAt(F)===43){aL=aa;F++}else{aL=ar;if(C===0){x(Y)}}if(aL===ar){if(aC.charCodeAt(F)===45){aL=W;F++}else{aL=ar;if(C===0){x(U)}}}if(aL!==ar){aK=av();if(aK!==ar){aJ=i();if(aJ!==ar){aS=av();if(aS!==ar){aQ=t();if(aQ!==ar){aM=[aM,aL,aK,aJ,aS,aQ];aN=aM}else{F=aN;aN=ar}}else{F=aN;aN=ar}}else{F=aN;aN=ar}}else{F=aN;aN=ar}}else{F=aN;aN=ar}}else{F=aN;aN=ar}}if(aO!==ar){q=aU;aT=S(aT,aP,aO);aU=aT}else{F=aU;aU=ar}}else{F=aU;aU=ar}}else{F=aU;aU=ar}}else{F=aU;aU=ar}return aU}function t(){var aS,aR,aQ,aP,aO,aN,aM,aL,aK,aJ;aS=F;aR=B();if(aR!==ar){aQ=[];aP=F;aO=av();if(aO!==ar){if(aC.charCodeAt(F)===42){aN=Q;F++}else{aN=ar;if(C===0){x(O)}}if(aN===ar){if(aC.charCodeAt(F)===47){aN=M;F++}else{aN=ar;if(C===0){x(K)}}if(aN===ar){if(aC.charCodeAt(F)===37){aN=I;F++}else{aN=ar;if(C===0){x(f)}}}}if(aN!==ar){aM=av();if(aM!==ar){aL=i();if(aL!==ar){aK=av();if(aK!==ar){aJ=B();if(aJ!==ar){aO=[aO,aN,aM,aL,aK,aJ];aP=aO}else{F=aP;aP=ar}}else{F=aP;aP=ar}}else{F=aP;aP=ar}}else{F=aP;aP=ar}}else{F=aP;aP=ar}}else{F=aP;aP=ar}while(aP!==ar){aQ.push(aP);aP=F;aO=av();if(aO!==ar){if(aC.charCodeAt(F)===42){aN=Q;F++}else{aN=ar;if(C===0){x(O)}}if(aN===ar){if(aC.charCodeAt(F)===47){aN=M;F++}else{aN=ar;if(C===0){x(K)}}if(aN===ar){if(aC.charCodeAt(F)===37){aN=I;F++}else{aN=ar;if(C===0){x(f)}}}}if(aN!==ar){aM=av();if(aM!==ar){aL=i();if(aL!==ar){aK=av();if(aK!==ar){aJ=B();if(aJ!==ar){aO=[aO,aN,aM,aL,aK,aJ];aP=aO}else{F=aP;aP=ar}}else{F=aP;aP=ar}}else{F=aP;aP=ar}}else{F=aP;aP=ar}}else{F=aP;aP=ar}}else{F=aP;aP=ar}}if(aQ!==ar){q=aS;aR=aI(aR,aQ);aS=aR}else{F=aS;aS=ar}}else{F=aS;aS=ar}return aS}function B(){var aS,aR,aQ,aP,aO,aN,aM,aL,aK,aJ;aS=F;aR=k();if(aR!==ar){aQ=[];aP=F;aO=av();if(aO!==ar){if(aC.charCodeAt(F)===94){aN=aH;F++}else{aN=ar;if(C===0){x(aF)}}if(aN!==ar){aM=av();if(aM!==ar){aL=i();if(aL!==ar){aK=av();if(aK!==ar){aJ=k();if(aJ!==ar){aO=[aO,aN,aM,aL,aK,aJ];aP=aO}else{F=aP;aP=ar}}else{F=aP;aP=ar}}else{F=aP;aP=ar}}else{F=aP;aP=ar}}else{F=aP;aP=ar}}else{F=aP;aP=ar}while(aP!==ar){aQ.push(aP);aP=F;aO=av();if(aO!==ar){if(aC.charCodeAt(F)===94){aN=aH;F++}else{aN=ar;if(C===0){x(aF)}}if(aN!==ar){aM=av();if(aM!==ar){aL=i();if(aL!==ar){aK=av();if(aK!==ar){aJ=k();if(aJ!==ar){aO=[aO,aN,aM,aL,aK,aJ];aP=aO}else{F=aP;aP=ar}}else{F=aP;aP=ar}}else{F=aP;aP=ar}}else{F=aP;aP=ar}}else{F=aP;aP=ar}}else{F=aP;aP=ar}}if(aQ!==ar){q=aS;aR=aE(aR,aQ);aS=aR}else{F=aS;aS=ar}}else{F=aS;aS=ar}return aS}function k(){var aT,aS,aQ,aP,aO,aN,aM,aL,aK,aJ,aR;aT=F;aS=d();if(aS===ar){aS=null}if(aS!==ar){if(aC.charCodeAt(F)===40){aQ=aD;F++}else{aQ=ar;if(C===0){x(aA)}}if(aQ!==ar){aP=av();if(aP!==ar){aO=aj();if(aO!==ar){aN=[];aM=F;aL=av();if(aL!==ar){if(aC.charCodeAt(F)===44){aK=az;F++}else{aK=ar;if(C===0){x(ay)}}if(aK!==ar){aJ=av();if(aJ!==ar){aR=aj();if(aR!==ar){aL=[aL,aK,aJ,aR];aM=aL}else{F=aM;aM=ar}}else{F=aM;aM=ar}}else{F=aM;aM=ar}}else{F=aM;aM=ar}while(aM!==ar){aN.push(aM);aM=F;aL=av();if(aL!==ar){if(aC.charCodeAt(F)===44){aK=az;F++}else{aK=ar;if(C===0){x(ay)}}if(aK!==ar){aJ=av();if(aJ!==ar){aR=aj();if(aR!==ar){aL=[aL,aK,aJ,aR];aM=aL}else{F=aM;aM=ar}}else{F=aM;aM=ar}}else{F=aM;aM=ar}}else{F=aM;aM=ar}}if(aN!==ar){aM=av();if(aM!==ar){if(aC.charCodeAt(F)===41){aL=ax;F++}else{aL=ar;if(C===0){x(au)}}if(aL!==ar){q=aT;aS=at(aS,aO,aN);aT=aS}else{F=aT;aT=ar}}else{F=aT;aT=ar}}else{F=aT;aT=ar}}else{F=aT;aT=ar}}else{F=aT;aT=ar}}else{F=aT;aT=ar}}else{F=aT;aT=ar}if(aT===ar){aT=g()}return aT}function i(){var aL,aK,aJ;C++;aL=F;aK=[];if(aC.charCodeAt(F)===45){aJ=W;F++}else{aJ=ar;if(C===0){x(U)}}if(aJ===ar){if(aC.charCodeAt(F)===43){aJ=aa;F++}else{aJ=ar;if(C===0){x(Y)}}if(aJ===ar){aJ=w()}}while(aJ!==ar){aK.push(aJ);if(aC.charCodeAt(F)===45){aJ=W;F++}else{aJ=ar;if(C===0){x(U)}}if(aJ===ar){if(aC.charCodeAt(F)===43){aJ=aa;F++}else{aJ=ar;if(C===0){x(Y)}}if(aJ===ar){aJ=w()}}}if(aK!==ar){q=aL;aK=ap(aK)}aL=aK;C--;if(aL===ar){aK=ar;if(C===0){x(aq)}}return aL}function g(){var aO,aN,aM,aL,aK,aJ,aP;C++;aO=F;aN=av();if(aN!==ar){aM=[];if(an.test(aC.charAt(F))){aL=aC.charAt(F);F++}else{aL=ar;if(C===0){x(am)}}if(aL!==ar){while(aL!==ar){aM.push(aL);if(an.test(aC.charAt(F))){aL=aC.charAt(F);F++}else{aL=ar;if(C===0){x(am)}}}}else{aM=ar}if(aM!==ar){aL=F;if(aC.charCodeAt(F)===46){aK=al;F++}else{aK=ar;if(C===0){x(ak)}}if(aK!==ar){aJ=[];if(an.test(aC.charAt(F))){aP=aC.charAt(F);F++}else{aP=ar;if(C===0){x(am)}}if(aP!==ar){while(aP!==ar){aJ.push(aP);if(an.test(aC.charAt(F))){aP=aC.charAt(F);F++}else{aP=ar;if(C===0){x(am)}}}}else{aJ=ar}if(aJ!==ar){aK=[aK,aJ];aL=aK}else{F=aL;aL=ar}}else{F=aL;aL=ar}if(aL===ar){aL=null}if(aL!==ar){q=aO;aN=ai();aO=aN}else{F=aO;aO=ar}}else{F=aO;aO=ar}}else{F=aO;aO=ar}if(aO===ar){aO=d()}C--;if(aO===ar){aN=ar;if(C===0){x(ao)}}return aO}function d(){var aU,aT,aR,aP,aO,aN,aM,aL,aK,aJ,aS,aQ;C++;aU=F;aT=av();if(aT!==ar){if(X.test(aC.charAt(F))){aR=aC.charAt(F);F++}else{aR=ar;if(C===0){x(V)}}if(aR!==ar){aP=[];if(T.test(aC.charAt(F))){aO=aC.charAt(F);F++}else{aO=ar;if(C===0){x(R)}}while(aO!==ar){aP.push(aO);if(T.test(aC.charAt(F))){aO=aC.charAt(F);F++}else{aO=ar;if(C===0){x(R)}}}if(aP!==ar){aO=av();if(aO!==ar){aN=[];aM=F;if(aC.charCodeAt(F)===46){aL=al;F++}else{aL=ar;if(C===0){x(ak)}}if(aL!==ar){aK=av();if(aK!==ar){if(X.test(aC.charAt(F))){aJ=aC.charAt(F);F++}else{aJ=ar;if(C===0){x(V)}}if(aJ!==ar){aS=[];if(T.test(aC.charAt(F))){aQ=aC.charAt(F);F++}else{aQ=ar;if(C===0){x(R)}}while(aQ!==ar){aS.push(aQ);if(T.test(aC.charAt(F))){aQ=aC.charAt(F);F++}else{aQ=ar;if(C===0){x(R)}}}if(aS!==ar){aQ=av();if(aQ!==ar){aL=[aL,aK,aJ,aS,aQ];aM=aL}else{F=aM;aM=ar}}else{F=aM;aM=ar}}else{F=aM;aM=ar}}else{F=aM;aM=ar}}else{F=aM;aM=ar}while(aM!==ar){aN.push(aM);aM=F;if(aC.charCodeAt(F)===46){aL=al;F++}else{aL=ar;if(C===0){x(ak)}}if(aL!==ar){aK=av();if(aK!==ar){if(X.test(aC.charAt(F))){aJ=aC.charAt(F);F++}else{aJ=ar;if(C===0){x(V)}}if(aJ!==ar){aS=[];if(T.test(aC.charAt(F))){aQ=aC.charAt(F);F++}else{aQ=ar;if(C===0){x(R)}}while(aQ!==ar){aS.push(aQ);if(T.test(aC.charAt(F))){aQ=aC.charAt(F);F++}else{aQ=ar;if(C===0){x(R)}}}if(aS!==ar){aQ=av();if(aQ!==ar){aL=[aL,aK,aJ,aS,aQ];aM=aL}else{F=aM;aM=ar}}else{F=aM;aM=ar}}else{F=aM;aM=ar}}else{F=aM;aM=ar}}else{F=aM;aM=ar}}if(aN!==ar){q=aU;aT=P();aU=aT}else{F=aU;aU=ar}}else{F=aU;aU=ar}}else{F=aU;aU=ar}}else{F=aU;aU=ar}}else{F=aU;aU=ar}C--;if(aU===ar){aT=ar;if(C===0){x(Z)}}return aU}function w(){var aK,aJ;C++;if(L.test(aC.charAt(F))){aK=aC.charAt(F);F++}else{aK=ar;if(C===0){x(J)}}C--;if(aK===ar){aJ=ar;if(C===0){x(N)}}return aK}function av(){var aK,aJ;C++;aK=[];if(L.test(aC.charAt(F))){aJ=aC.charAt(F);F++}else{aJ=ar;if(C===0){x(J)}}while(aJ!==ar){aK.push(aJ);if(L.test(aC.charAt(F))){aJ=aC.charAt(F);F++}else{aJ=ar;if(C===0){x(J)}}}C--;if(aK===ar){aJ=ar;if(C===0){x(H)}}return aK}var ae="new BigDecimal(";var z=".negate()";var v={"+":".add(","-":".subtract(","*":".multiply(","/":".divide(","%":".remainder(","^":".pow("};function p(aM){for(var aK=1;aK<arguments.length;++aK){var aL=arguments[aK];if(aL instanceof Array){for(var aJ=0;aJ<aL.length;++aJ){aM.push(aL[aJ])}}else{aM.push(aL)}}return aM}function j(aN,aK,aJ){var aM=aJ;for(var aL=0;aL<aN.length;++aL){aM=aK(aM,aN[aL])}return aM}function l(aK){var aL=false;for(var aJ=0;aJ<aK.length;++aJ){if(aK[aJ]==="-"){aL=!aL}}return aL?z:""}function G(aJ){return v[aJ]}o=af();if(o!==ar&&F===aC.length){return o}else{if(o!==ar&&F<aC.length){x(ab())}throw y(aB,A<aC.length?aC.charAt(A):null,A<aC.length?aG(A,A+1):aG(A,A))}}return{SyntaxError:b,parse:a}})();var selectedTxt=Editor.GetSelectedString();if(selectedTxt.length!=0){try{var textFirst=OPTION_LEAVE_FORMULA_AS_A_COMMENT?"/*"+selectedTxt+"*/ ":"";var textJavCd=JDecConverter.parse(selectedTxt);Editor.InsText(textFirst+textJavCd)}catch(e){Editor.ErrorMsg("申し訳ありません。数式の解析に失敗しました。\r\nエラー情報: "+e.toString())}}else{Editor.ErrorMsg("変換する数式を選択してください")};